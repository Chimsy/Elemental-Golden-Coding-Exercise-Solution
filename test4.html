<!--
QUESTION 4:

With javascript/jquery build a table listing using the data from the customers array (stored in data.js).
The listing should show the customer's name and age.
Above the listing add a textbox.
Entering a value will search all names which contains the entered string.
When you search for a number range (20-30) it will filter the results based off the customer's age.
E.g When you search for 20-30 it must list everyone with ages in that range.
Please make sure your code runs as effectively as it can.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Test4</title>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="data.js"></script>
    <style>
        table {
            border-collapse: collapse;
            width: 400px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        #searchInput {
            width: 300px;
            padding: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
<h1>Search Customers</h1>
<div class="data-container">
    <input type="text" id="searchInput" placeholder="Search by name or age range (e.g., 20-30)">

    <div id="customerTableContainer"></div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        function calculateAge(birthdateString) {
            const today = new Date();
            const birthDate = new Date(birthdateString);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        customers.forEach(function (customer) {
            customer.age = calculateAge(customer.birthdate);
        });


        function renderTable(customerList) {
            if (customerList.length === 0) {
                $('#customerTableContainer').html('<p>No results found.</p>');
                return;
            }

            let tableHtml = '<table>';
            tableHtml += '<thead><tr><th>Name</th><th>Age</th></tr></thead>';
            tableHtml += '<tbody>';

            customerList.forEach(function (customer) {
                tableHtml += '<tr>';
                tableHtml += '<td>' + customer.name + '</td>';
                tableHtml += '<td>' + customer.age + '</td>';
                tableHtml += '</tr>';
            });

            tableHtml += '</tbody></table>';

            $('#customerTableContainer').html(tableHtml);
        }

        // Event listener for the search input
        $('#searchInput').on('keyup', function () {
            const searchValue = $(this).val().trim();

            const ageRangeRegex = /^\s*(\d+)\s*-\s*(\d+)\s*$/;
            const match = searchValue.match(ageRangeRegex);

            let filteredCustomers = [];

            if (match) {
                const minAge = parseInt(match[1], 10);
                const maxAge = parseInt(match[2], 10);

                const rangeMin = Math.min(minAge, maxAge);
                const rangeMax = Math.max(minAge, maxAge);

                filteredCustomers = customers.filter(function (customer) {
                    return customer.age >= rangeMin && customer.age <= rangeMax;
                });

            } else {
                const searchTerm = searchValue.toLowerCase();

                filteredCustomers = customers.filter(function (customer) {
                    return customer.name.toLowerCase().includes(searchTerm);
                });
            }

            renderTable(filteredCustomers);
        });

        renderTable(customers);
    });
</script>
</body>
</html>